<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Asistente Legend</title>

<style>
    body {
        font-family: Arial;
        background: #ffe9cc;
        margin: 0;
        padding: 0;
    }

    .navbar {
        background: linear-gradient(90deg, #ff7f00, #ff9e42);
        color: white;
        padding: 15px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 3px 8px rgba(0,0,0,0.20);
    }

    .navbar .logo {
        font-size: 1.4rem;
        font-weight: 700;
    }

    .navbar .nav-actions button {
        background: rgba(255,255,255,0.2);
        border: none;
        padding: 10px 15px;
        margin-left: 8px;
        border-radius: 8px;
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: 0.25s;
    }

    .navbar .nav-actions button:hover {
        background: rgba(255,255,255,0.35);
    }

    .navbar .nav-actions button.active {
        background: white;
        color: #ff7f00;
    }

    .container {
        padding: 2rem;
        text-align: center;
        max-width: 1000px;
        margin: auto;
    }

    .legend-analyzer {
        background: #fff7ee;
        padding: 1.5rem;
        border-radius: 12px;
        margin-top: 2rem;
        border: 1px solid #ffd6a0;
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        max-width: 900px;
        margin-left: auto;
        margin-right: auto;
        text-align: left;
    }

    .legend-response-bubble {
        margin-top: 1rem;
        background: white;
        border: 2px solid #ffa54a;
        border-radius: 10px;
        padding: 12px;
        font-size: 0.95rem;
        box-shadow: 0 3px 10px rgba(0,0,0,0.15);
        position: relative;
        text-align: left;
    }
    .legend-response-bubble::after {
        content: "";
        position: absolute;
        top: -15px;
        left: 20px;
        border-width: 15px;
        border-style: solid;
        border-color: transparent transparent #ffa54a transparent;
    }

    .legend-analyzer textarea {
        width: 100%;
        border-radius: 6px;
        border: 1px solid #ccc;
        padding: 8px;
    }

    button {
        padding: 10px 20px;
        background: #ff7f00;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
        margin-top: 10px;
    }
</style>
</head>

<body>

<header class="navbar">
    <div class="logo">ü§ñ Legend Assistant</div>

    <div class="nav-actions">
        <button onclick="window.location.href='panelSeleccion.html'">üè† Inicio</button>
        <button onclick="window.location.href='manualUsuarioNokia.html'">üìò Manual</button>
        <button class="active">ü§ñ Asistente</button>
        <button onclick="window.history.back()">‚¨ÖÔ∏è Atr√°s</button>
    </div>
</header>

<div class="container">

<h1>üß† Legend ‚Äî Modo Asistente Avanzado</h1>
<p>Sube tu XML y preg√∫ntame algo.</p>

<div class="legend-analyzer">

    <h3>üîç Analizador + Comandos Inteligentes</h3>

    <label><b>üìÑ Cargar XML:</b></label><br>
    <input type="file" id="xmlInput" accept=".xml"><br><br>

    <textarea id="userQuestion" placeholder="Ejemplo: borrar celda del sector 3 celda 3G" rows="3"></textarea><br>

    <button onclick="procesarPregunta()">Preguntar a Legend</button>

    <div id="legendResponse"></div>

</div>
</div>

<script>
const API_URL = "https://nokia-backend.onrender.com/borrarWNCELG";

// ID fijo elegido ‚Üí Sector 3
const WNCEL_ID_SECTOR3 = "192101108";

async function procesarPregunta() {

    const pregunta = document.getElementById("userQuestion").value.toLowerCase();
    const archivo = document.getElementById("xmlInput").files[0];

    if (!archivo) {
        alert("Debes cargar un XML primero.");
        return;
    }

    // Detectar comando del usuario
    const borrar3g = (
        pregunta.includes("borrar") &&
        pregunta.includes("sector 3") &&
        pregunta.includes("3g")
    );

    if (!borrar3g) {
        document.getElementById("legendResponse").innerHTML =
        `<div class='legend-response-bubble'>
            ‚ùå No entiendo esa instrucci√≥n.<br>
            Puedes decir: <b>borrar celda del sector 3 celda 3G</b>
        </div>`;
        return;
    }

    // Construir paquete
    let formData = new FormData();
    formData.append("xml_file", archivo);
    formData.append("wncel_id", WNCEL_ID_SECTOR3);

    // Llamar a la API de Render
    const resp = await fetch(API_URL, {
        method: "POST",
        body: formData
    });

    if (!resp.ok) {
        document.getElementById("legendResponse").innerHTML =
        `<div class='legend-response-bubble'>
            ‚ùå Error al procesar la solicitud.<br>
            No se pudo borrar la celda 3G del sector 3.
        </div>`;
        return;
    }

    // Descargar XML modificado
    const blob = await resp.blob();
    const url = window.URL.createObjectURL(blob);

    const link = document.createElement("a");
    link.href = url;
    link.download = "XML_sin_sector3_3G.xml";
    link.click();

    document.getElementById("legendResponse").innerHTML =
    `<div class='legend-response-bubble'>
        ‚úî Operaci√≥n completada.<br><br>
        La celda <b>3G</b> del <b>sector 3</b> fue eliminada correctamente.<br>
        üì• Archivo descargado.
    </div>`;
}
</script>

</body>
</html>
